From 10513561b2216b47695cc2aea267c34c1b230a84 Mon Sep 17 00:00:00 2001
From: Victor Bo <bvoid@yandex.ru>
Date: Thu, 17 Dec 2020 01:58:25 -0500
Subject: [PATCH 134/208] Fix deadlock between AppOpsService and
 HistoricalRegistry

  from
  https://github.com/syberia-project/platform_frameworks_base/commit/fb981fead4f8d94f68fe8f0af4096f3dcd530c80
---
 services/core/java/com/android/server/appop/AppOpsService.java | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/services/core/java/com/android/server/appop/AppOpsService.java b/services/core/java/com/android/server/appop/AppOpsService.java
index 902b2e2228f..2bd23e93407 100644
--- a/services/core/java/com/android/server/appop/AppOpsService.java
+++ b/services/core/java/com/android/server/appop/AppOpsService.java
@@ -1795,9 +1795,8 @@ public class AppOpsService extends IAppOpsService.Stub {
                     }
                 }
             }
-
-            mHistoricalRegistry.clearHistory(uid, packageName);
         }
+        mHistoricalRegistry.clearHistory(uid, packageName);
     }
 
     public void uidRemoved(int uid) {
-- 
2.17.1

