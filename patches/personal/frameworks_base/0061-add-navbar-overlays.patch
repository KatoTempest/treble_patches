From 096217ee66c6671b44e362229b4d1c0fa133ed66 Mon Sep 17 00:00:00 2001
From: Victor Bo <bvoid@yandex.ru>
Date: Thu, 12 Nov 2020 03:14:32 -0500
Subject: [PATCH] add navbar overlays

  based on https://github.com/LineageOS/android_packages_overlays_Lineage/commit/35fb8bae39e632c947e2fa65e2c9eca20ded5cd0
---
 .../systemui/theme/ThemeOverlayManager.java   |  8 ++++-
 packages/overlays/Android.mk                  |  2 ++
 .../NavigationBarNoHintIMEOverlay/Android.mk  | 27 ++++++++++++++++
 .../AndroidManifest.xml                       | 24 ++++++++++++++
 .../res/values/dimens.xml                     | 17 ++++++++++
 .../NavigationBarNoHintOverlay/Android.mk     | 27 ++++++++++++++++
 .../AndroidManifest.xml                       | 24 ++++++++++++++
 .../res/values/config.xml                     | 32 +++++++++++++++++++
 .../res/values/dimens.xml                     | 13 ++++++++
 9 files changed, 173 insertions(+), 1 deletion(-)
 create mode 100644 packages/overlays/NavigationBarNoHintIMEOverlay/Android.mk
 create mode 100644 packages/overlays/NavigationBarNoHintIMEOverlay/AndroidManifest.xml
 create mode 100644 packages/overlays/NavigationBarNoHintIMEOverlay/res/values/dimens.xml
 create mode 100644 packages/overlays/NavigationBarNoHintOverlay/Android.mk
 create mode 100644 packages/overlays/NavigationBarNoHintOverlay/AndroidManifest.xml
 create mode 100644 packages/overlays/NavigationBarNoHintOverlay/res/values/config.xml
 create mode 100644 packages/overlays/NavigationBarNoHintOverlay/res/values/dimens.xml

diff --git a/packages/SystemUI/src/com/android/systemui/theme/ThemeOverlayManager.java b/packages/SystemUI/src/com/android/systemui/theme/ThemeOverlayManager.java
index e4d5320c392..6e509121f64 100644
--- a/packages/SystemUI/src/com/android/systemui/theme/ThemeOverlayManager.java
+++ b/packages/SystemUI/src/com/android/systemui/theme/ThemeOverlayManager.java
@@ -85,6 +85,9 @@ class ThemeOverlayManager {
     @VisibleForTesting
     static final String OVERLAY_CATEGORY_PADDING =
             "android.theme.customization.padding";
+    @VisibleForTesting
+    static final String OVERLAY_CATEGORY_NAVBAR =
+            "android.theme.customization.navbar";
 
     /*
      * All theme customization categories used by the system, in order that they should be applied,
@@ -96,6 +99,7 @@ class ThemeOverlayManager {
             OVERLAY_CATEGORY_FONT,
             OVERLAY_CATEGORY_COLOR,
             OVERLAY_CATEGORY_QSPANEL,
+            OVERLAY_CATEGORY_NAVBAR,
             OVERLAY_CATEGORY_PADDING,
             OVERLAY_CATEGORY_STATUSBAR,
             OVERLAY_CATEGORY_QSALPHA,
@@ -113,6 +117,7 @@ class ThemeOverlayManager {
             OVERLAY_CATEGORY_FONT,
             OVERLAY_CATEGORY_SHAPE,
             OVERLAY_CATEGORY_QSPANEL,
+            OVERLAY_CATEGORY_NAVBAR,
             OVERLAY_CATEGORY_PADDING,
             OVERLAY_CATEGORY_STATUSBAR,
             OVERLAY_CATEGORY_QSALPHA,
@@ -139,7 +144,7 @@ class ThemeOverlayManager {
         mTargetPackageToCategories.put(ANDROID_PACKAGE, Sets.newHashSet(
                 OVERLAY_CATEGORY_COLOR, OVERLAY_CATEGORY_FONT, OVERLAY_CATEGORY_STATUSBAR,
                 OVERLAY_CATEGORY_SHAPE, OVERLAY_CATEGORY_ICON_ANDROID, OVERLAY_CATEGORY_DARKUI,
-                OVERLAY_CATEGORY_SPEEDUI));
+                OVERLAY_CATEGORY_SPEEDUI, OVERLAY_CATEGORY_NAVBAR));
         mTargetPackageToCategories.put(SYSUI_PACKAGE,
                 Sets.newHashSet(OVERLAY_CATEGORY_ICON_SYSUI, OVERLAY_CATEGORY_QSPANEL,
                                 OVERLAY_CATEGORY_QSALPHA, OVERLAY_CATEGORY_PADDING));
@@ -156,6 +161,7 @@ class ThemeOverlayManager {
         mCategoryToTargetPackage.put(OVERLAY_CATEGORY_STATUSBAR, ANDROID_PACKAGE);
         mCategoryToTargetPackage.put(OVERLAY_CATEGORY_DARKUI, ANDROID_PACKAGE);
         mCategoryToTargetPackage.put(OVERLAY_CATEGORY_SPEEDUI, ANDROID_PACKAGE);
+        mCategoryToTargetPackage.put(OVERLAY_CATEGORY_NAVBAR, ANDROID_PACKAGE);
         mCategoryToTargetPackage.put(OVERLAY_CATEGORY_QSPANEL, SYSUI_PACKAGE);
         mCategoryToTargetPackage.put(OVERLAY_CATEGORY_QSALPHA, SYSUI_PACKAGE);
         mCategoryToTargetPackage.put(OVERLAY_CATEGORY_PADDING, SYSUI_PACKAGE);
diff --git a/packages/overlays/Android.mk b/packages/overlays/Android.mk
index 963c8e70efa..09287f86adb 100644
--- a/packages/overlays/Android.mk
+++ b/packages/overlays/Android.mk
@@ -143,6 +143,8 @@ LOCAL_REQUIRED_MODULES := \
 	NavigationBarModeGesturalOverlayNarrowBack \
 	NavigationBarModeGesturalOverlayWideBack \
 	NavigationBarModeGesturalOverlayExtraWideBack \
+	NavigationBarNoHintOverlay \
+	NavigationBarNoHintIMEOverlay \
 	preinstalled-packages-platform-overlays.xml
 
 include $(BUILD_PHONY_PACKAGE)
diff --git a/packages/overlays/NavigationBarNoHintIMEOverlay/Android.mk b/packages/overlays/NavigationBarNoHintIMEOverlay/Android.mk
new file mode 100644
index 00000000000..c44b9f8e314
--- /dev/null
+++ b/packages/overlays/NavigationBarNoHintIMEOverlay/Android.mk
@@ -0,0 +1,27 @@
+#
+#  Copyright 2018, The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#     http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+LOCAL_PATH:= $(call my-dir)
+include $(CLEAR_VARS)
+
+LOCAL_RRO_THEME := NavigationBarNoHintIME
+
+LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
+
+LOCAL_PACKAGE_NAME := NavigationBarNoHintIMEOverlay
+LOCAL_SDK_VERSION := current
+
+include $(BUILD_RRO_PACKAGE)
diff --git a/packages/overlays/NavigationBarNoHintIMEOverlay/AndroidManifest.xml b/packages/overlays/NavigationBarNoHintIMEOverlay/AndroidManifest.xml
new file mode 100644
index 00000000000..11958b6ae5f
--- /dev/null
+++ b/packages/overlays/NavigationBarNoHintIMEOverlay/AndroidManifest.xml
@@ -0,0 +1,24 @@
+<!--
+/**
+ * Copyright (c) 2019, The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<manifest xmlns:android="http://schemas.android.com/apk/res/android"
+    package="com.android.theme.navbar.nohintime"
+    android:versionCode="1"
+    android:versionName="1.0">
+    <overlay android:targetPackage="android" android:category="android.theme.customization.navbar" android:priority="1"/>
+    <application android:label="Hide hint and IME space" android:hasCode="false"/>
+</manifest>
diff --git a/packages/overlays/NavigationBarNoHintIMEOverlay/res/values/dimens.xml b/packages/overlays/NavigationBarNoHintIMEOverlay/res/values/dimens.xml
new file mode 100644
index 00000000000..6660f790316
--- /dev/null
+++ b/packages/overlays/NavigationBarNoHintIMEOverlay/res/values/dimens.xml
@@ -0,0 +1,17 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+ * SPDX-License-Identifier: Apache-2.0
+ * Copyright (C) 2020 The LineageOS Project
+-->
+<resources>
+    <!-- Height of the bottom navigation / system bar. -->
+    <dimen name="navigation_bar_height">0dp</dimen>
+    <!-- Height of the bottom navigation bar in portrait; often the same as @dimen/navigation_bar_height -->
+    <dimen name="navigation_bar_height_landscape">0dp</dimen>
+    <!-- Width of the navigation bar when it is placed vertically on the screen -->
+    <dimen name="navigation_bar_width">0dp</dimen>
+    <!-- Height of the bottom navigation / system bar. -->
+    <dimen name="navigation_bar_frame_height">0dp</dimen>
+    <!-- The height of the bottom navigation gesture area. -->
+    <dimen name="navigation_bar_gesture_height">24dp</dimen>
+</resources>
diff --git a/packages/overlays/NavigationBarNoHintOverlay/Android.mk b/packages/overlays/NavigationBarNoHintOverlay/Android.mk
new file mode 100644
index 00000000000..673c5b62b52
--- /dev/null
+++ b/packages/overlays/NavigationBarNoHintOverlay/Android.mk
@@ -0,0 +1,27 @@
+#
+#  Copyright 2018, The Android Open Source Project
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#     http://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
+LOCAL_PATH:= $(call my-dir)
+include $(CLEAR_VARS)
+
+LOCAL_RRO_THEME := NavigationBarNoHint
+
+LOCAL_RESOURCE_DIR := $(LOCAL_PATH)/res
+
+LOCAL_PACKAGE_NAME := NavigationBarNoHintOverlay
+LOCAL_SDK_VERSION := current
+
+include $(BUILD_RRO_PACKAGE)
diff --git a/packages/overlays/NavigationBarNoHintOverlay/AndroidManifest.xml b/packages/overlays/NavigationBarNoHintOverlay/AndroidManifest.xml
new file mode 100644
index 00000000000..21cce93b642
--- /dev/null
+++ b/packages/overlays/NavigationBarNoHintOverlay/AndroidManifest.xml
@@ -0,0 +1,24 @@
+<!--
+/**
+ * Copyright (c) 2019, The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<manifest xmlns:android="http://schemas.android.com/apk/res/android"
+    package="com.android.theme.navbar.nohint"
+    android:versionCode="1"
+    android:versionName="1.0">
+    <overlay android:targetPackage="android" android:category="android.theme.customization.navbar" android:priority="1"/>
+    <application android:label="Hide gestural hint" android:hasCode="false"/>
+</manifest>
diff --git a/packages/overlays/NavigationBarNoHintOverlay/res/values/config.xml b/packages/overlays/NavigationBarNoHintOverlay/res/values/config.xml
new file mode 100644
index 00000000000..e2516d4ff46
--- /dev/null
+++ b/packages/overlays/NavigationBarNoHintOverlay/res/values/config.xml
@@ -0,0 +1,32 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+/**
+ * Copyright (c) 2019, The Android Open Source Project
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+-->
+<resources>
+    <!-- Controls whether the navbar needs a scrim with
+     {@link Window#setEnsuringNavigationBarContrastWhenTransparent}. -->
+    <bool name="config_navBarNeedsScrim">false</bool>
+
+    <!-- Controls the opacity of the navigation bar depending on the visibility of the
+     various workspace stacks.
+     0 - Nav bar is always opaque when either the freeform stack or docked stack is visible.
+     1 - Nav bar is always translucent when the freeform stack is visible, otherwise always
+         opaque.
+     2 - Nav bar is never forced opaque.
+     -->
+    <integer name="config_navBarOpacityMode">1</integer>
+</resources>
diff --git a/packages/overlays/NavigationBarNoHintOverlay/res/values/dimens.xml b/packages/overlays/NavigationBarNoHintOverlay/res/values/dimens.xml
new file mode 100644
index 00000000000..f389f83e64c
--- /dev/null
+++ b/packages/overlays/NavigationBarNoHintOverlay/res/values/dimens.xml
@@ -0,0 +1,13 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+ * SPDX-License-Identifier: Apache-2.0
+ * Copyright (C) 2020 The LineageOS Project
+-->
+<resources>
+    <!-- Height of the bottom navigation / system bar. -->
+    <dimen name="navigation_bar_height">0dp</dimen>
+    <!-- Height of the bottom navigation bar in portrait; often the same as @dimen/navigation_bar_height -->
+    <dimen name="navigation_bar_height_landscape">0dp</dimen>
+    <!-- Width of the navigation bar when it is placed vertically on the screen -->
+    <dimen name="navigation_bar_width">0dp</dimen>
+</resources>
-- 
2.17.1

