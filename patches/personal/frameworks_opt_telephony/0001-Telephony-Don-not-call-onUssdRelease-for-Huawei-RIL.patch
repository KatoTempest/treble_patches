From 507b466286b4ea87f779e76b942ebc11769bf12d Mon Sep 17 00:00:00 2001
From: Victor Bo <bvoid@yandex.ru>
Date: Sun, 13 Dec 2020 09:05:27 -0500
Subject: [PATCH] Telephony: Don not call onUssdRelease for Huawei RIL

  from
  https://github.com/phhusson/platform_frameworks_opt_telephony/commit/7fbca8db2df233af0cd1fb1048cb4d25cbbc6ca7
---
 src/java/com/android/internal/telephony/GsmCdmaPhone.java | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/src/java/com/android/internal/telephony/GsmCdmaPhone.java b/src/java/com/android/internal/telephony/GsmCdmaPhone.java
index ec339c05c..136d06275 100644
--- a/src/java/com/android/internal/telephony/GsmCdmaPhone.java
+++ b/src/java/com/android/internal/telephony/GsmCdmaPhone.java
@@ -2548,7 +2548,11 @@ public class GsmCdmaPhone extends Phone {
             // Complete pending USSD
 
             if (isUssdRelease) {
-                found.onUssdRelease();
+                if (SystemProperties.getBoolean("persist.sys.radio.huawei", false)) {
+                    found.onUssdFinished(ussdMessage, isUssdRequest);
+                } else {
+                    found.onUssdRelease();
+                }
             } else if (isUssdError) {
                 found.onUssdFinishedError();
             } else {
-- 
2.17.1

