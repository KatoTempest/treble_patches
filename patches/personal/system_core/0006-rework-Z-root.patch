From 0a78198ec7151b050ddb865c70c6f9e7645a7c8c Mon Sep 17 00:00:00 2001
From: Victor Bo <bvoid@yandex.ru>
Date: Wed, 3 Mar 2021 06:31:17 -0500
Subject: [PATCH 6/6] rework Z root

---
 libcutils/fs_config.cpp    | 2 +-
 rootdir/Android.mk         | 1 +
 rootdir/init.environ.rc.in | 1 +
 3 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/libcutils/fs_config.cpp b/libcutils/fs_config.cpp
index 6bd72c4ce..499f09603 100644
--- a/libcutils/fs_config.cpp
+++ b/libcutils/fs_config.cpp
@@ -192,7 +192,7 @@ static const struct fs_path_config android_files[] = {
     { 04750, AID_ROOT,      AID_SHELL,     0, "system/xbin/su" },
 
     // for enhanced root
-    { 00755, AID_ROOT,      AID_ROOT,      0, "system/phh/xbin/su" },
+    { 00755, AID_ROOT,      AID_ROOT,      0, "system/phh/zbin/su" },
 
     // the following files have enhanced capabilities and ARE included
     // in user builds.
diff --git a/rootdir/Android.mk b/rootdir/Android.mk
index 288c5273c..ef2e5d567 100644
--- a/rootdir/Android.mk
+++ b/rootdir/Android.mk
@@ -80,6 +80,7 @@ LOCAL_POST_INSTALL_CMD := mkdir -p $(addprefix $(TARGET_ROOT_OUT)/, \
     sbin dev proc sys system data data_mirror odm oem acct config storage mnt apex debug_ramdisk \
     linkerconfig postinstall $(BOARD_ROOT_EXTRA_FOLDERS)); \
     mkdir -p $(TARGET_OUT)/xbin; \
+    mkdir -p $(TARGET_OUT)/zbin; \
     ln -sf /system/bin $(TARGET_ROOT_OUT)/bin; \
     ln -sf /system/etc $(TARGET_ROOT_OUT)/etc; \
     ln -sf /data/user_de/0/com.android.shell/files/bugreports $(TARGET_ROOT_OUT)/bugreports; \
diff --git a/rootdir/init.environ.rc.in b/rootdir/init.environ.rc.in
index fdaaf1abe..b34145829 100644
--- a/rootdir/init.environ.rc.in
+++ b/rootdir/init.environ.rc.in
@@ -10,6 +10,7 @@ on early-init
     export ANDROID_TZDATA_ROOT /apex/com.android.tzdata
     export EXTERNAL_STORAGE /sdcard
     export ASEC_MOUNTPOINT /mnt/asec
+    export PATH /sbin:/product/bin:/apex/com.android.runtime/bin:/apex/com.android.art/bin:/system_ext/bin:/system/bin:/system/xbin:/system/zbin:/odm/bin:/vendor/bin:/vendor/xbin
     export BOOTCLASSPATH %BOOTCLASSPATH%
     export DEX2OATBOOTCLASSPATH %DEX2OATBOOTCLASSPATH%
     export SYSTEMSERVERCLASSPATH %SYSTEMSERVERCLASSPATH%
-- 
2.17.1

