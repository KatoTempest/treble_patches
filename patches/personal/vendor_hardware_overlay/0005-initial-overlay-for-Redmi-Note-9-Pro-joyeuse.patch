From c38f1136f4a90af9435a0debacb8e6f10afcb1ef Mon Sep 17 00:00:00 2001
From: Victor Bo <bvoid@yandex.ru>
Date: Wed, 9 Dec 2020 15:07:43 -0500
Subject: [PATCH 05/13] initial overlay for Redmi Note 9 Pro 'joyeuse'

  -wip-
---
 Xiaomi/RedmiNote9Pro/Android.mk               |   8 +
 Xiaomi/RedmiNote9Pro/AndroidManifest.xml      |  10 +
 Xiaomi/RedmiNote9Pro/res/values/config.xml    | 261 ++++++++++++++++++
 .../RedmiNote9Pro/res/xml/power_profile.xml   | 101 +++++++
 overlay.mk                                    |   1 +
 5 files changed, 381 insertions(+)
 create mode 100644 Xiaomi/RedmiNote9Pro/Android.mk
 create mode 100644 Xiaomi/RedmiNote9Pro/AndroidManifest.xml
 create mode 100644 Xiaomi/RedmiNote9Pro/res/values/config.xml
 create mode 100644 Xiaomi/RedmiNote9Pro/res/xml/power_profile.xml

diff --git a/Xiaomi/RedmiNote9Pro/Android.mk b/Xiaomi/RedmiNote9Pro/Android.mk
new file mode 100644
index 0000000..1005fe2
--- /dev/null
+++ b/Xiaomi/RedmiNote9Pro/Android.mk
@@ -0,0 +1,8 @@
+LOCAL_PATH := $(call my-dir)
+include $(CLEAR_VARS)
+LOCAL_MODULE_TAGS := optional
+LOCAL_PACKAGE_NAME := treble-overlay-xiaomi-redminote9pro
+LOCAL_MODULE_PATH := $(TARGET_OUT_PRODUCT)/overlay
+LOCAL_IS_RUNTIME_RESOURCE_OVERLAY := true
+LOCAL_PRIVATE_PLATFORM_APIS := true
+include $(BUILD_PACKAGE)
diff --git a/Xiaomi/RedmiNote9Pro/AndroidManifest.xml b/Xiaomi/RedmiNote9Pro/AndroidManifest.xml
new file mode 100644
index 0000000..d12d1a1
--- /dev/null
+++ b/Xiaomi/RedmiNote9Pro/AndroidManifest.xml
@@ -0,0 +1,10 @@
+<manifest xmlns:android="http://schemas.android.com/apk/res/android"
+        package="me.phh.treble.overlay.xiaomi.redminote9pro"
+        android:versionCode="1"
+        android:versionName="1.0">
+        <overlay android:targetPackage="android"
+                 android:requiredSystemPropertyName="ro.vendor.build.fingerprint"
+                 android:requiredSystemPropertyValue="+*edmi/joyeuse*"
+                 android:priority="169"
+                 android:isStatic="true" />
+</manifest>
diff --git a/Xiaomi/RedmiNote9Pro/res/values/config.xml b/Xiaomi/RedmiNote9Pro/res/values/config.xml
new file mode 100644
index 0000000..6f702d5
--- /dev/null
+++ b/Xiaomi/RedmiNote9Pro/res/values/config.xml
@@ -0,0 +1,261 @@
+<?xml version="1.0" encoding="utf-8"?>
+<resources>
+    <integer-array name="config_autoBrightnessDisplayValuesNits">
+        <item>5</item>
+        <item>5</item>
+        <item>5</item>
+        <item>5</item>
+        <item>15</item>
+        <item>24</item>
+        <item>37</item>
+        <item>47</item>
+        <item>61</item>
+        <item>76</item>
+        <item>83</item>
+        <item>83</item>
+        <item>83</item>
+        <item>87</item>
+        <item>93</item>
+        <item>107</item>
+        <item>117</item>
+        <item>124</item>
+        <item>133</item>
+        <item>166</item>
+        <item>182</item>
+        <item>270</item>
+        <item>315</item>
+        <item>373</item>
+        <item>442</item>
+        <item>455</item>
+    </integer-array>
+    <integer-array name="config_autoBrightnessLcdBacklightValues">
+        <item>48</item>
+        <item>48</item>
+        <item>48</item>
+        <item>48</item>
+        <item>128</item>
+        <item>208</item>
+        <item>320</item>
+        <item>400</item>
+        <item>528</item>
+        <item>656</item>
+        <item>720</item>
+        <item>720</item>
+        <item>720</item>
+        <item>752</item>
+        <item>800</item>
+        <item>928</item>
+        <item>1008</item>
+        <item>1072</item>
+        <item>1152</item>
+        <item>1440</item>
+        <item>1584</item>
+        <item>2400</item>
+        <item>2800</item>
+        <item>3328</item>
+        <item>3968</item>
+        <item>4095</item>
+    </integer-array>
+    <integer-array name="config_autoBrightnessLevels">
+        <item>1</item>
+        <item>2</item>
+        <item>4</item>
+        <item>5</item>
+        <item>8</item>
+        <item>13</item>
+        <item>17</item>
+        <item>21</item>
+        <item>26</item>
+        <item>30</item>
+        <item>34</item>
+        <item>39</item>
+        <item>60</item>
+        <item>140</item>
+        <item>310</item>
+        <item>400</item>
+        <item>500</item>
+        <item>600</item>
+        <item>1000</item>
+        <item>1200</item>
+        <item>1500</item>
+        <item>2100</item>
+        <item>3000</item>
+        <item>3500</item>
+        <item>4000</item>
+    </integer-array>
+    <integer-array name="config_screenBrightnessBacklight">
+        <item>0</item>
+        <item>1</item>
+        <item>10</item>
+        <item>15</item>
+        <item>30</item>
+        <item>45</item>
+        <item>60</item>
+        <item>75</item>
+        <item>90</item>
+        <item>105</item>
+        <item>120</item>
+        <item>135</item>
+        <item>150</item>
+        <item>165</item>
+        <item>180</item>
+        <item>195</item>
+        <item>210</item>
+        <item>225</item>
+        <item>240</item>
+        <item>255</item>
+    </integer-array>
+    <integer-array name="config_screenBrightnessNits">
+        <item>0</item>
+        <item>4</item>
+        <item>22</item>
+        <item>30</item>
+        <item>68</item>
+        <item>95</item>
+        <item>133</item>
+        <item>165</item>
+        <item>192</item>
+        <item>218</item>
+        <item>255</item>
+        <item>290</item>
+        <item>326</item>
+        <item>352</item>
+        <item>384</item>
+        <item>399</item>
+        <item>422</item>
+        <item>432</item>
+        <item>442</item>
+        <item>455</item>
+    </integer-array>
+
+    <integer-array name="config_availableColorModes">
+        <item>0</item>
+        <item>1</item>
+        <item>3</item>
+    </integer-array>
+    <string-array name="config_mobile_tcp_buffers">
+        <item>5gnr:2097152,6291456,16777216,512000,2097152,8388608</item>
+        <item>lte:2097152,4194304,8388608,262144,524288,1048576</item>
+        <item>lte_ca:4096,6291456,12582912,4096,1048576,2097152</item>
+        <item>umts:4094,87380,1220608,4096,16384,1220608</item>
+        <item>hspa:4094,87380,1220608,4096,16384,1220608</item>
+        <item>hsupa:4094,87380,1220608,4096,16384,1220608</item>
+        <item>hsdpa:4094,87380,1220608,4096,16384,1220608</item>
+        <item>hspap:4094,87380,1220608,4096,16384,1220608</item>
+        <item>edge:4093,26280,35040,4096,16384,35040</item>
+        <item>gprs:4092,8760,11680,4096,8760,11680</item>
+        <item>evdo:4094,87380,524288,4096,16384,262144</item>
+    </string-array>
+    <string-array name="config_tether_bluetooth_regexs">
+        <item>bnep\\d</item>
+        <item>bt-pan</item>
+    </string-array>
+    <integer-array name="config_tether_upstream_types">
+        <item>0</item>
+        <item>1</item>
+        <item>5</item>
+        <item>7</item>
+    </integer-array>
+    <string-array name="config_tether_usb_regexs">
+        <item>usb\\d</item>
+        <item>rndis\\d</item>
+    </string-array>
+    <string-array name="config_tether_wifi_regexs">
+        <item>softap0</item>
+        <item>wlan0</item>
+    </string-array>
+    <string-array name="networkAttributes">
+        <item>wifi,1,1,1,-1,true</item>
+        <item>mobile,0,0,0,-1,true</item>
+        <item>mobile_mms,2,0,4,60000,true</item>
+        <item>mobile_supl,3,0,2,60000,true</item>
+        <item>mobile_dun,4,0,2,60000,true</item>
+        <item>mobile_hipri,5,0,3,60000,true</item>
+        <item>mobile_fota,10,0,2,60000,true</item>
+        <item>mobile_ims,11,0,2,60000,true</item>
+        <item>mobile_cbs,12,0,2,60000,true</item>
+        <item>bluetooth,7,7,2,-1,true</item>
+        <item>mobile_emergency,15,0,5,-1,true</item>
+        <item>ethernet,9,9,9,-1,true</item>
+    </string-array>
+    <string-array name="radioAttributes">
+        <item>1,1</item>
+        <item>0,1</item>
+        <item>7,1</item>
+    </string-array>
+
+    <integer-array name="config_virtualKeyVibePattern">
+        <item>0</item>
+        <item>8</item>
+        <item>16</item>
+    </integer-array>
+    <integer-array name="config_longPressVibePattern">
+        <item>0</item>
+        <item>14</item>
+        <item>20</item>
+    </integer-array>
+    <integer-array name="config_keyboardTapVibePattern">
+        <item>10</item>
+    </integer-array>
+
+    <bool name="config_automatic_brightness_available">true</bool>
+    <bool name="config_dozeAlwaysOnDisplayAvailable">true</bool>
+    <bool name="config_fillMainBuiltInDisplayCutout">false</bool>
+    <bool name="config_useDevInputEventForAudioJack">true</bool>
+
+    <bool name="config_bluetooth_le_peripheral_mode_supported">true</bool>
+    <bool name="config_carrier_volte_available">true</bool>
+    <bool name="config_device_volte_available">true</bool>
+    <bool name="config_device_vt_available">true</bool>
+    <bool name="config_device_wfc_ims_available">true</bool>
+    <bool name="config_dozeAfterScreenOff">true</bool>
+    <bool name="config_dynamic_bind_ims">true</bool>
+    <bool name="config_hotswapCapable">true</bool>
+    <bool name="config_powerDecoupleInteractiveModeFromDisplay">false</bool>
+    <bool name="config_setColorTransformAccelerated">true</bool>
+    <bool name="config_showNavigationBar">true</bool>
+    <bool name="config_speed_up_audio_on_mt_calls">true</bool>
+    <bool name="config_supportAudioSourceUnprocessed">true</bool>
+    <bool name="config_switch_phone_on_voice_reg_state_change">false</bool>
+    <bool name="config_wifiDisplaySupportsProtectedBuffers">true</bool>
+    <bool name="config_wifi_background_scan_support">true</bool>
+    <bool name="config_wifi_batched_scan_supported">true</bool>
+    <bool name="config_wifi_connected_mac_randomization_supported">true</bool>
+    <bool name="config_wifi_dual_band_support">true</bool>
+    <bool name="config_wifi_p2p_mac_randomization_supported">true</bool>
+    <bool name="skip_restoring_network_selection">true</bool>
+
+    <bool name="config_lidControlsSleep">true</bool>
+    <bool name="config_displayBlanksAfterDoze">true</bool>
+    <bool name="config_powerDecoupleAutoSuspendModeFromDisplay">true</bool>
+
+    <bool name="config_intrusiveNotificationLed">true</bool>
+    <bool name="config_dozeAfterScreenOffByDefault">true</bool>
+
+    <dimen name="rounded_corner_radius_bottom">93.0px</dimen>
+    <dimen name="rounded_corner_radius_top">93.0px</dimen>
+    <dimen name="status_bar_height_portrait">102.0px</dimen>
+    <dimen name="status_bar_height_landscape">24dp</dimen>
+
+    <fraction name="config_autoBrightnessAdjustmentMaxGamma">100.0%</fraction>
+    <fraction name="config_maximumScreenDimRatio">29.999996%</fraction>
+
+    <integer name="config_autoBrightnessBrighteningLightDebounce">1000</integer>
+    <integer name="config_autoBrightnessDarkeningLightDebounce">1000</integer>
+    <integer name="config_brightness_ramp_rate_fast">4933</integer>
+    <integer name="config_brightness_ramp_rate_slow">3946</integer>
+    <integer name="config_screenBrightnessDim">32</integer>
+    <integer name="config_screenBrightnessSettingDefault">1072</integer>
+    <integer name="config_screenBrightnessSettingMaximum">4095</integer>
+    <integer name="config_screenBrightnessSettingMinimum">32</integer>
+
+    <integer name="config_bluetooth_idle_cur_ma">3</integer>
+    <integer name="config_bluetooth_operating_voltage_mv">3700</integer>
+    <integer name="config_bluetooth_rx_cur_ma">20</integer>
+    <integer name="config_bluetooth_tx_cur_ma">33</integer>
+    <integer name="config_screenBrightnessDoze">17</integer>
+
+    <integer name="config_shutdownBatteryTemperature">600</integer>
+
+    <string name="config_mainBuiltInDisplayCutout">M 0,0 H -36 V 102 H 36 V 0 H 0 Z</string>
+</resources>
diff --git a/Xiaomi/RedmiNote9Pro/res/xml/power_profile.xml b/Xiaomi/RedmiNote9Pro/res/xml/power_profile.xml
new file mode 100644
index 0000000..a26a899
--- /dev/null
+++ b/Xiaomi/RedmiNote9Pro/res/xml/power_profile.xml
@@ -0,0 +1,101 @@
+<?xml version="1.0" encoding="utf-8"?>
+<device name="Android">
+    <item name="battery.capacity">5020</item>
+    <array name="cpu.clusters.cores">
+        <value>6</value>
+        <value>2</value>
+    </array>
+    <item name="cpu.suspend">4.65</item>
+    <item name="cpu.idle">0.52</item>
+    <item name="cpu.active">1</item>
+    <item name="cpu.cluster_power.cluster0">12.10</item>
+    <item name="cpu.cluster_power.cluster1">16.43</item>
+    <array name="cpu.core_speeds.cluster0">
+        <value>300000</value>
+        <value>576000</value>
+        <value>768000</value>
+        <value>1017600</value>
+        <value>1248000</value>
+        <value>1324800</value>
+        <value>1516800</value>
+        <value>1612800</value>
+        <value>1708800</value>
+        <value>1804800</value>
+    </array>
+    <array name="cpu.core_speeds.cluster1">
+        <value>652800</value>
+        <value>825600</value>
+        <value>979200</value>
+        <value>1113600</value>
+        <value>1267200</value>
+        <value>1555200</value>
+        <value>1708800</value>
+        <value>1843200</value>
+        <value>1900800</value>
+        <value>1996800</value>
+        <value>2112000</value>
+        <value>2208000</value>
+    </array>
+    <array name="cpu.core_power.cluster0">
+        <value>4.2</value>
+        <value>8.28</value>
+        <value>11.99</value>
+        <value>15.06</value>
+        <value>23.81</value>
+        <value>27.99</value>
+        <value>38.22</value>
+        <value>51.99</value>
+        <value>62.37</value>
+        <value>71.82</value>
+    </array>
+    <array name="cpu.core_power.cluster1">
+        <value>11.06</value>
+        <value>23.81</value>
+        <value>35.09</value>
+        <value>44.08</value>
+        <value>73.08</value>
+        <value>87.18</value>
+        <value>134.31</value>
+        <value>192.47</value>
+        <value>216.45</value>
+        <value>257.83</value>
+        <value>289.78</value>
+        <value>337.24</value>
+    </array>
+    <item name="screen.on">82.45</item>
+    <item name="screen.full">242.93</item>
+    <item name="camera.flashlight">245.859</item>
+    <item name="camera.avg">500</item>
+    <item name="video">83.29</item>
+    <item name="audio">37.41</item>
+    <item name="wifi.controller.idle">2</item>
+    <item name="wifi.controller.rx">220</item>
+    <item name="wifi.controller.tx">150</item>
+    <item name="wifi.controller.voltage">3700</item>
+    <item name="modem.controller.sleep">1</item>
+    <item name="modem.controller.idle">1</item>
+    <item name="modem.controller.rx">100</item>
+    <array name="modem.controller.tx">
+        <value>90</value>
+        <value>100</value>
+        <value>110</value>
+        <value>120</value>
+        <value>130</value>
+    </array>
+    <item name="modem.controller.voltage">3700</item>
+    <array name="gps.signalqualitybased">
+        <value>100</value>
+        <value>110</value>
+    </array>
+    <item name="gps.voltage">3700</item>
+    <item name="bluetooth.controller.idle">1</item>
+    <item name="bluetooth.controller.rx">50</item>
+    <item name="bluetooth.controller.tx">50</item>
+    <item name="bluetooth.controller.voltage">3300</item>
+    <item name="radio.active">100</item>
+    <item name="radio.scanning">50</item>
+    <array name="radio.on">
+        <value>7</value>
+        <value>5</value>
+    </array>
+</device>
\ No newline at end of file
diff --git a/overlay.mk b/overlay.mk
index 5507e65..68c562b 100755
--- a/overlay.mk
+++ b/overlay.mk
@@ -158,5 +158,6 @@ PRODUCT_PACKAGES += \
 	treble-overlay-xiaomi-redminote6pro-systemui \
 	treble-overlay-xiaomi-redminote7 \
 	treble-overlay-xiaomi-redminote8pro \
+	treble-overlay-xiaomi-redminote9pro \
 	treble-overlay-xiaomi-redmis2 \
 
-- 
2.17.1

