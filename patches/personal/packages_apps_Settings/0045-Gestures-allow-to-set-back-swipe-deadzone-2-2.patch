From c4dddf22e6b0841f03327a44b531ec34c9cc7793 Mon Sep 17 00:00:00 2001
From: Victor Bo <bvoid@yandex.ru>
Date: Sun, 13 Dec 2020 08:49:30 -0500
Subject: [PATCH 45/63] Gestures: allow to set back swipe deadzone [2/2]

  based on
  https://github.com/ezio84/abc_packages_apps_Settings/commit/a00e620ae5b3015400af20c10d349d5eaa68029e

Change-Id: I9920897bfcadb26a7a88c98f3fa4eea3cb96e9ca
---
 res/values-it/custom_strings.xml              | 17 ++++++++++++++
 res/values-ru/custom_strings.xml              |  4 ++++
 res/values/custom_strings.xml                 |  4 ++++
 res/xml/gesture_navigation_settings.xml       |  8 +++++++
 .../GestureNavigationSettingsFragment.java    | 22 +++++++++++++++++++
 5 files changed, 55 insertions(+)
 create mode 100644 res/values-it/custom_strings.xml

diff --git a/res/values-it/custom_strings.xml b/res/values-it/custom_strings.xml
new file mode 100644
index 0000000000..b727f3641c
--- /dev/null
+++ b/res/values-it/custom_strings.xml
@@ -0,0 +1,17 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!-- Copyright (C) 2007 The Android Open Source Project
+     Licensed under the Apache License, Version 2.0 (the "License");
+     you may not use this file except in compliance with the License.
+     You may obtain a copy of the License at
+          http://www.apache.org/licenses/LICENSE-2.0
+     Unless required by applicable law or agreed to in writing, software
+     distributed under the License is distributed on an "AS IS" BASIS,
+     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+     See the License for the specific language governing permissions and
+     limitations under the License.
+-->
+<resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
+    <string name="smallest_tick_label">Off</string>
+    <string name="greatest_tick_label">Metà schermo</string>
+    <string name="gesture_back_deadzone_label">Zona morta</string>
+</resources>
diff --git a/res/values-ru/custom_strings.xml b/res/values-ru/custom_strings.xml
index ced82f14c3..e56b550ad8 100644
--- a/res/values-ru/custom_strings.xml
+++ b/res/values-ru/custom_strings.xml
@@ -72,4 +72,8 @@
     <!-- Battery stats reset -->
     <string name="battery_stats_reset">Сброс статистики</string>
     <string name="battery_stats_message">Статистика батареи будет сброшена</string>
+    <!-- Back swipe deadzone -->
+    <string name="smallest_tick_label">Целиком</string>
+    <string name="greatest_tick_label">Половина экрана</string>
+    <string name="gesture_back_deadzone_label">Вертикальная область жестов</string>
 </resources>
diff --git a/res/values/custom_strings.xml b/res/values/custom_strings.xml
index 7fd7ac01a0..be0f001411 100644
--- a/res/values/custom_strings.xml
+++ b/res/values/custom_strings.xml
@@ -70,4 +70,8 @@
     <!-- Battery stats reset -->
     <string name="battery_stats_reset">Reset stats</string>
     <string name="battery_stats_message">Battery history stats are going to be reset</string>
+		<!-- Back swipe deadzone -->
+    <string name="smallest_tick_label">Full</string>
+    <string name="greatest_tick_label">Half screen</string>
+    <string name="gesture_back_deadzone_label">Gesture height area</string>
 </resources>
diff --git a/res/xml/gesture_navigation_settings.xml b/res/xml/gesture_navigation_settings.xml
index b44ba09bb8..2e4b06fd5c 100644
--- a/res/xml/gesture_navigation_settings.xml
+++ b/res/xml/gesture_navigation_settings.xml
@@ -45,6 +45,14 @@
             settings:textEnd="@string/high_label"/>
     </PreferenceCategory>
 
+    <com.android.settings.widget.LabeledSeekBarPreference
+        android:key="gesture_back_deadzone"
+        android:title="@string/gesture_back_deadzone_label"
+        android:max="3"
+        android:selectable="true"
+        settings:textStart="@string/smallest_tick_label"
+        settings:textEnd="@string/greatest_tick_label"/>
+
     <PreferenceCategory
         android:key="gesture_navbar_category"
         android:persistent="false"
diff --git a/src/com/android/settings/gestures/GestureNavigationSettingsFragment.java b/src/com/android/settings/gestures/GestureNavigationSettingsFragment.java
index 2753f7edc4..2e3440ff16 100644
--- a/src/com/android/settings/gestures/GestureNavigationSettingsFragment.java
+++ b/src/com/android/settings/gestures/GestureNavigationSettingsFragment.java
@@ -50,6 +50,7 @@ public class GestureNavigationSettingsFragment extends DashboardFragment {
     private static final String LEFT_EDGE_SEEKBAR_KEY = "gesture_left_back_sensitivity";
     private static final String RIGHT_EDGE_SEEKBAR_KEY = "gesture_right_back_sensitivity";
     private static final String GESTURE_NAVBAR_TUNING_KEY = "gesture_navbar_tuning";
+    private static final String DEADZONE_SEEKBAR_KEY = "gesture_back_deadzone";
 
     private static final String HIDE_OVERLAY_PKG = "com.android.theme.navbar.hidehandle";
     private static final String LONG_OVERLAY_PKG = "com.android.theme.navbar.longhandle";
@@ -90,6 +91,7 @@ public class GestureNavigationSettingsFragment extends DashboardFragment {
         initSeekBarPreference(LEFT_EDGE_SEEKBAR_KEY);
         initSeekBarPreference(RIGHT_EDGE_SEEKBAR_KEY);
         initSeekBarPreference(GESTURE_NAVBAR_TUNING_KEY);
+        initDeadzoneSeekBarPreference(DEADZONE_SEEKBAR_KEY);
     }
 
     @Override
@@ -226,6 +228,26 @@ public class GestureNavigationSettingsFragment extends DashboardFragment {
         }
     }
 
+    private void initDeadzoneSeekBarPreference(final String key) {
+        final LabeledSeekBarPreference pref = getPreferenceScreen().findPreference(key);
+        pref.setContinuousUpdates(true);
+
+        int mode = Settings.System.getInt(getContext().getContentResolver(),
+            Settings.System.EDGE_GESTURE_Y_DEAD_ZONE, 0);
+        pref.setProgress(mode);
+
+        pref.setOnPreferenceChangeListener((p, v) -> {
+            // TODO show deadzone preview setting indicator view height
+            return true;
+        });
+
+        pref.setOnPreferenceChangeStopListener((p, v) -> {
+            Settings.System.putInt(getContext().getContentResolver(),
+                    Settings.System.EDGE_GESTURE_Y_DEAD_ZONE, (int)v);
+            return true;
+        });
+    }
+
     private static float[] getFloatArray(TypedArray array) {
         int length = array.length();
         float[] floatArray = new float[length];
-- 
2.30.2

